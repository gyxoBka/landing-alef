const cards = [
    {
        img: "assets/images/cats/cat1.jpg",
        title: "Кот полосатый",
        discount: 40,
        color: "Коричневый",
        age: 2,
        paw: 4,
        price: 30000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat2.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 3,
        paw: 4,
        price: 40000,
        amount: 0
    },
    {
        img: "assets/images/cats/cat3.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 6,
        paw: 4,
        price: 20000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat1.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 2,
        paw: 4,
        price: 25000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat3.jpg",
        title: "Кот полосатый",
        discount: 40,
        color: "Коричневый",
        age: 3,
        paw: 4,
        price: 30000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat2.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 2,
        paw: 4,
        price: 10000,
        amount: 0
    },
    {
        img: "assets/images/cats/cat1.jpg",
        title: "Кот полосатый",
        discount: 40,
        color: "Коричневый",
        age: 2,
        paw: 4,
        price: 30000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat2.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 3,
        paw: 4,
        price: 40000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat3.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 6,
        paw: 4,
        price: 20000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat1.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 2,
        paw: 4,
        price: 25000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat3.jpg",
        title: "Кот полосатый",
        discount: 40,
        color: "Коричневый",
        age: 3,
        paw: 4,
        price: 30000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat2.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 2,
        paw: 4,
        price: 25000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat1.jpg",
        title: "Кот полосатый",
        discount: 40,
        color: "Коричневый",
        age: 2,
        paw: 4,
        price: 30000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat2.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 3,
        paw: 4,
        price: 40000,
        amount: 0
    },
    {
        img: "assets/images/cats/cat3.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 6,
        paw: 4,
        price: 20000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat1.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 2,
        paw: 4,
        price: 25000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat3.jpg",
        title: "Кот полосатый",
        discount: 40,
        color: "Коричневый",
        age: 3,
        paw: 4,
        price: 30000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat2.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 2,
        paw: 4,
        price: 10000,
        amount: 0
    },
    {
        img: "assets/images/cats/cat1.jpg",
        title: "Кот полосатый",
        discount: 40,
        color: "Коричневый",
        age: 2,
        paw: 4,
        price: 30000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat2.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 3,
        paw: 4,
        price: 40000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat3.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 6,
        paw: 4,
        price: 20000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat1.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 2,
        paw: 4,
        price: 25000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat3.jpg",
        title: "Кот полосатый",
        discount: 40,
        color: "Коричневый",
        age: 3,
        paw: 4,
        price: 30000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat2.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 2,
        paw: 4,
        price: 25000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat1.jpg",
        title: "Кот полосатый",
        discount: 40,
        color: "Коричневый",
        age: 2,
        paw: 4,
        price: 30000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat2.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 3,
        paw: 4,
        price: 40000,
        amount: 0
    },
    {
        img: "assets/images/cats/cat3.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 6,
        paw: 4,
        price: 20000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat1.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 2,
        paw: 4,
        price: 25000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat3.jpg",
        title: "Кот полосатый",
        discount: 40,
        color: "Коричневый",
        age: 3,
        paw: 4,
        price: 30000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat2.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 2,
        paw: 4,
        price: 10000,
        amount: 0
    },
    {
        img: "assets/images/cats/cat1.jpg",
        title: "Кот полосатый",
        discount: 40,
        color: "Коричневый",
        age: 2,
        paw: 4,
        price: 30000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat2.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 3,
        paw: 4,
        price: 40000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat3.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 6,
        paw: 4,
        price: 20000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat1.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 2,
        paw: 4,
        price: 25000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat3.jpg",
        title: "Кот полосатый",
        discount: 40,
        color: "Коричневый",
        age: 3,
        paw: 4,
        price: 30000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat2.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 2,
        paw: 4,
        price: 25000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat1.jpg",
        title: "Кот полосатый",
        discount: 40,
        color: "Коричневый",
        age: 2,
        paw: 4,
        price: 30000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat2.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 3,
        paw: 4,
        price: 40000,
        amount: 0
    },
    {
        img: "assets/images/cats/cat3.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 6,
        paw: 4,
        price: 20000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat1.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 2,
        paw: 4,
        price: 25000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat3.jpg",
        title: "Кот полосатый",
        discount: 40,
        color: "Коричневый",
        age: 3,
        paw: 4,
        price: 30000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat2.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 2,
        paw: 4,
        price: 10000,
        amount: 0
    },
    {
        img: "assets/images/cats/cat1.jpg",
        title: "Кот полосатый",
        discount: 40,
        color: "Коричневый",
        age: 2,
        paw: 4,
        price: 30000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat2.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 3,
        paw: 4,
        price: 40000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat3.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 6,
        paw: 4,
        price: 20000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat1.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 2,
        paw: 4,
        price: 25000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat3.jpg",
        title: "Кот полосатый",
        discount: 40,
        color: "Коричневый",
        age: 3,
        paw: 4,
        price: 30000,
        amount: 10
    },
    {
        img: "assets/images/cats/cat2.jpg",
        title: "Кот полосатый",
        discount: 0,
        color: "Коричневый",
        age: 2,
        paw: 4,
        price: 25000,
        amount: 10
    }
];

const cardWrapper = document.querySelector('.card-wrapper');
const notifyWrapper = document.querySelector('.notify');
const sortBtns = document.querySelectorAll('.sort__method');
const showMore = document.querySelector('.show-more');

const startCardDraw = 6;
const cardDrawPerRow = 20;

let cardDraw = 0;

document.addEventListener("DOMContentLoaded", () => {
    loadCards(0, startCardDraw);
});

sortBtns.forEach(sort => {
    sort.addEventListener('click', () => {
        sortCards(sort.getAttribute("data-type"), sort.getAttribute("data-sort"));
    });
});

function sortCards(type = "", sort = "") {
    let sortMethod = sort === "ascend" ? true : false;

    for(let i = 0; i < cardWrapper.children.length; i++) {
        for(let k = i; k < cardWrapper.children.length; k++) {
            if(sortMethod) {
                if(+cardWrapper.children[i].getAttribute(type) > +cardWrapper.children[k].getAttribute(type)) {
                    replaceNode = cardWrapper.replaceChild(cardWrapper.children[k], cardWrapper.children[i]);
                    insertAfter(replaceNode, cardWrapper.children[i]);
                }
            } else {
                if(+cardWrapper.children[i].getAttribute(type) < +cardWrapper.children[k].getAttribute(type)) {
                    replaceNode = cardWrapper.replaceChild(cardWrapper.children[k], cardWrapper.children[i]);
                    insertAfter(replaceNode, cardWrapper.children[i]);
                }
            }
        }
    }
}
showMore.addEventListener('click', (e) => {
    loadCards(cardDraw, cardDrawPerRow);
});

function loadCards(start = 0, drawNum = 0) {
    let len = (start + drawNum) < cards.length ? (start + drawNum) : cards.length;

    for(let i = start; i < len; i++) {
        cardDraw++;
        createCard(cards[i]);
    }

    updateShowMoreBtn();

    const cardLikes = document.querySelectorAll('.card__like');

    cardLikes.forEach(like => {
        registeClickLike(like);
    });
}

function updateShowMoreBtn() {
    let showNum = cards.length - cardDraw;

    if(!showNum) 
    {
        showMore.remove();
        return false;
    }

    showMore.querySelector('.show-more__num').innerText = ` ${showNum > cardDrawPerRow ? cardDrawPerRow : showNum}`;

    return true;
}

function insertAfter(el, refEl) {
    console.log(refEl);
    return refEl.parentNode.insertBefore(el, refEl.nextSibling);
}

function registeClickLike(th) {
    th.addEventListener('click', () => {
        let parent = th.closest('.card');

        if(!th.classList.contains('card__like_liked')) {
            th.classList.add('card__like_liked');
            showLikedNotify(true, parent.querySelector('.card__title').innerText, "Добавлен в избранное");
        }
        else {
            th.classList.remove('card__like_liked');
            showLikedNotify(false, parent.querySelector('.card__title').innerText, "Удален из избранного");
        }
    });
}

function createCard(card) {
    let newCard = `    <div class="card" data-price="${card.price}" data-age="${card.age}">
    <div class="card__header">
        <div class="card__img">
            <img src="${card.img}" alt="catCard">
        </div>`;

    if(card.discount) {
        newCard += `<div class="card__discount">-${card.discount}%</div>`;
    }

    newCard += `
    <div class="card__like">
    <img src="assets/images/like.svg" alt="like">
    </div>
    </div>
    <div class="card__body">
    <div class="card__title">Кот полосатый</div>
    <div class="card__features">
        <div class="card__features-wrapper">
            <div class="card__color">${card.color} окрас</div>
        </div>

        <div class="card__features-wrapper">
            <div class="card__age card_text-bold">${card.age} мес.</div>
            <div class="card__description">Возраст</div>
        </div>
        <div class="card__features-wrapper">
            <div class="card__paw card_text-bold">${card.paw}</div>
            <div class="card__description">Кол-во лап</div>
        </div>
    </div>
    <div class="card__price">${card.price} руб.</div>
    </div>
    `;

    if(card.amount) {
        newCard += `<button class="card__btn">Купить</button>
        </div>`
    } else {
        newCard += `<button class="card__btn unavailable">Продан</button>
        </div>`
    }
    
    cardWrapper.innerHTML += newCard;
}

function showLikedNotify(type = true, header = "", body = "") {
    let notify = document.createElement('div');
    
    if(type == true) {
        notify.classList.add('notify__item', 'notify__item--add');
    }
    else {
        notify.classList.add('notify__item', 'notify__item--rm');
    }

    notifyWrapper.appendChild(notify);

    notify.innerHTML = `
        <div class="notify__close"><img src="/assets/images/close.svg" alt="закрыть"></div>
        <div class="notify__header">${header}</div>
        <div class="notify__body">${body}</div>
    </div>`;

    let removeTimer = setTimeout(() => {
        removeNotify(notify);
    }, 5000);

    closeBtn = notify.querySelector('.notify__close');

    closeBtn.addEventListener('click', () => {
        clearTimeout(removeTimer);
        removeNotify(notify);
    });
}

function removeNotify(th) {
    th.classList.add('notify__item--remove');
    setTimeout(() => {
        if(th.parentNode != null)
            th.remove();
    }, 500);
}

(function() {
    if (!Element.prototype.closest) {

        Element.prototype.closest = function(css) {
            var node = this;

            while (node) {
                if (node.matches(css)) return node;
                else node = node.parentElement;
            }
            return null;
        };
    }
})();

(function() {

    if (!Element.prototype.matches) {
        Element.prototype.matches = Element.prototype.matchesSelector ||
        Element.prototype.webkitMatchesSelector ||
        Element.prototype.mozMatchesSelector ||
        Element.prototype.msMatchesSelector;

    }

})();